<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BoardG">
	<resultMap id="ResultMap" type="BoardG" >
		<result column="postNo" property="postNo"/>
		<result column="id" property="id"/>
		<result column="subject" property="subject"/>
		<result column="content" property="content"/>
		<result column="writeDate" property="writeDate"/>
		<result column="ip" property="ip"/>
		<result column="readCnt" property="readCnt"/>
		<result column="good" property="good"/>
		<result column="bad" property="bad"/>
		<result column="comments" property="comments"/>
		<result column="img" property="img"/>
	</resultMap>
	
<!-- total -->
	<select id="total" resultType="int">
		SELECT count(postNo) from boardG where postNo>0 
	</select>
	
<!-- last postNo -->
	<select id="lastPno" resultType="int">
		SELECT nvl( max(abs(postNo)), 0 ) from boardG
	</select>

<!-- list -->	
	<select id="list" parameterType="BoardG" resultMap="ResultMap">
		select * from (
			select rownum rn, a.* from ( select * from boardG where postNo>0 order by postNo desc) a 
		) where rn between #{startRow} and #{endRow}
	</select>
	
<!-- readPost -->	
	<select id="readPost" parameterType="String" resultType="BoardG">
		select * from boardG where postNo = #{postNo} and postNo>0 
	</select>
	
<!-- increaseCnt -->
	<update id="increaseCnt" parameterType="String">
		update boardG set readCnt = readCnt + 1 where postNo=#{postNo}
	</update>
	
<!-- writePost -->
	<insert id="writePost" parameterType="BoardG">
		insert into boardG (postNo, id, subject, content, ip, writeDate, img) 
			values (#{postNo}, #{id}, #{subject}, #{content, jdbcType=VARCHAR}, #{ip}, sysdate, #{img,jdbcType=VARCHAR})
	</insert>

<!-- modifyPost -->	
	<update id="modifyPost" parameterType="BoardG">
		update boardG set subject=#{subject}, content=#{content}, ip=#{ip} 
		<if test="img != null">
			, img=#{img } 
  		</if> where postNo=#{postNo}
	</update>
	
<!-- deletePost -->
	<update id="deletePost" parameterType="int">
		update boardG set postNo=(#{postNo} * -1) where postNo=#{postNo}
	</update>

<!-- hit List -->	
	<select id="hitList" resultMap="ResultMap">
		select * from (
			select rownum rn, a.* from (select * from boardG order by good desc) a
		) where <![CDATA[rn<=10]]>
	</select>
</mapper>